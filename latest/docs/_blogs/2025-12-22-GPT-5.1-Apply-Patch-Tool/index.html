<!DOCTYPE html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A programming framework for agentic AI"><meta name=author content="Chi Wang & Qingyun Wu"><link href=https://docs.ag2.ai/latest/docs/_blogs/2025-12-22-GPT-5.1-Apply-Patch-Tool/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.19"><title>GPT-5.1 Apply Patch Tool: Automated Code Editing in AG2 - AG2</title><link rel=stylesheet href=../../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../css/timeago.css><link rel=stylesheet href=../../../assets/_mkdocstrings.css><link rel=stylesheet href=../../../stylesheets/extra.ff0633.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2GN2KN2CE4"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2GN2KN2CE4",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2GN2KN2CE4",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta http-equiv=Cache-Control content="no-cache, no-store, must-revalidate"><meta property=og:type content=website><meta property=og:title content="AG2 - GPT-5.1 Apply Patch Tool: Automated Code Editing in AG2"><meta property=og:description content="A programming framework for agentic AI"><meta content=https://docs.ag2.ai/latest/docs/_blogs/2025-12-22-GPT-5.1-Apply-Patch-Tool/ property=og:url><meta property=og:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="AG2 - GPT-5.1 Apply Patch Tool: Automated Code Editing in AG2"><meta name=twitter:description content="A programming framework for agentic AI"><meta name=twitter:image content=https://opengraph.githubassets.com/1671805243.560327/ag2ai/ag2><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon-dark.svg type=image/x-icon media="(prefers-color-scheme: light)"><link rel=icon href=https://docs.ag2.ai/latest/assets/img/favicon.svg type=image/x-icon media="(prefers-color-scheme: dark)"><link href=../../../assets/stylesheets/glightbox.min.css rel=stylesheet><script src=../../../assets/javascripts/glightbox.min.js></script><style id=glightbox-style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#what-is-apply-patch class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=AG2 class="md-header__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../assets/img/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> AG2 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> GPT-5.1 Apply Patch Tool: Automated Code Editing in AG2 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../quick-start/ class=md-tabs__link> Quick Start </a> </li> <li class=md-tabs__item> <a href=../../user-guide/basic-concepts/installing-ag2/ class=md-tabs__link> User Guide </a> </li> <li class=md-tabs__item> <a href=../../api-reference/autogen/Agent/ class=md-tabs__link> API References </a> </li> <li class=md-tabs__item> <a href=../../contributor-guide/contributing/ class=md-tabs__link> Contributor Guide </a> </li> <li class=md-tabs__item> <a href=../../ecosystem/agentops/ class=md-tabs__link> Ecosystem </a> </li> <li class=md-tabs__item> <a href=../../use-cases/use-cases/customer-service/ class=md-tabs__link> Use Cases </a> </li> <li class=md-tabs__item> <a href=../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-tabs__link> Community Insights </a> </li> <li class=md-tabs__item> <a href=../../blog/ class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=AG2 class="md-nav__button md-logo" aria-label=AG2 data-md-component=logo> <img src=../../../assets/img/logo.svg alt=logo> </a> AG2 </label> <div class=md-nav__source> <a href=https://github.com/ag2ai/ag2 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class=md-source__repository> ag2ai/ag2 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../user-guide/basic-concepts/installing-ag2/ class=md-nav__link> <span class=md-ellipsis> User Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../api-reference/autogen/Agent/ class=md-nav__link> <span class=md-ellipsis> API References </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../contributor-guide/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributor Guide </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../ecosystem/agentops/ class=md-nav__link> <span class=md-ellipsis> Ecosystem </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../use-cases/use-cases/customer-service/ class=md-nav__link> <span class=md-ellipsis> Use Cases </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../user-stories/2025-04-30-Cegid-Pulse-OS/cegid_pulse_os/ class=md-nav__link> <span class=md-ellipsis> Community Insights </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../blog/ class=md-nav__link> <span class=md-ellipsis> Blog </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-is-apply-patch class=md-nav__link> <span class=md-ellipsis> What is Apply Patch? </span> </a> </li> <li class=md-nav__item> <a href=#understanding-the-diff-format class=md-nav__link> <span class=md-ellipsis> Understanding the Diff Format </span> </a> </li> <li class=md-nav__item> <a href=#basic-setup-and-configuration class=md-nav__link> <span class=md-ellipsis> Basic Setup and Configuration </span> </a> <nav class=md-nav aria-label="Basic Setup and Configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installation class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=#configuration class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=#creating-your-first-agent class=md-nav__link> <span class=md-ellipsis> Creating Your First Agent </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#creating-projects-with-apply-patch class=md-nav__link> <span class=md-ellipsis> Creating Projects with Apply Patch </span> </a> <nav class=md-nav aria-label="Creating Projects with Apply Patch"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-1-simple-project-scaffolding class=md-nav__link> <span class=md-ellipsis> Example 1: Simple Project Scaffolding </span> </a> </li> <li class=md-nav__item> <a href=#example-2-complete-application-structure class=md-nav__link> <span class=md-ellipsis> Example 2: Complete Application Structure </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#workspace-directory-configuration class=md-nav__link> <span class=md-ellipsis> Workspace Directory Configuration </span> </a> <nav class=md-nav aria-label="Workspace Directory Configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#setting-up-a-workspace class=md-nav__link> <span class=md-ellipsis> Setting Up a Workspace </span> </a> </li> <li class=md-nav__item> <a href=#using-workspace-directory class=md-nav__link> <span class=md-ellipsis> Using Workspace Directory </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#security-with-allowed-paths class=md-nav__link> <span class=md-ellipsis> Security with Allowed Paths </span> </a> <nav class=md-nav aria-label="Security with Allowed Paths"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#understanding-allowed-paths class=md-nav__link> <span class=md-ellipsis> Understanding Allowed Paths </span> </a> </li> <li class=md-nav__item> <a href=#configuring-allowed-paths class=md-nav__link> <span class=md-ellipsis> Configuring Allowed Paths </span> </a> </li> <li class=md-nav__item> <a href=#testing-path-restrictions class=md-nav__link> <span class=md-ellipsis> Testing Path Restrictions </span> </a> </li> <li class=md-nav__item> <a href=#security-best-practices class=md-nav__link> <span class=md-ellipsis> Security Best Practices </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#asynchronous-patch-operations class=md-nav__link> <span class=md-ellipsis> Asynchronous Patch Operations </span> </a> <nav class=md-nav aria-label="Asynchronous Patch Operations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enabling-async-patches class=md-nav__link> <span class=md-ellipsis> Enabling Async Patches </span> </a> </li> <li class=md-nav__item> <a href=#using-async-patches class=md-nav__link> <span class=md-ellipsis> Using Async Patches </span> </a> </li> <li class=md-nav__item> <a href=#when-to-use-async class=md-nav__link> <span class=md-ellipsis> When to Use Async </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#implementation-patterns class=md-nav__link> <span class=md-ellipsis> Implementation Patterns </span> </a> <nav class=md-nav aria-label="Implementation Patterns"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pattern-1-iterative-code-improvement class=md-nav__link> <span class=md-ellipsis> Pattern 1: Iterative Code Improvement </span> </a> </li> <li class=md-nav__item> <a href=#pattern-2-multi-agent-collaboration class=md-nav__link> <span class=md-ellipsis> Pattern 2: Multi-Agent Collaboration </span> </a> </li> <li class=md-nav__item> <a href=#pattern-3-test-driven-development class=md-nav__link> <span class=md-ellipsis> Pattern 3: Test-Driven Development </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#best-practices class=md-nav__link> <span class=md-ellipsis> Best Practices </span> </a> <nav class=md-nav aria-label="Best Practices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-start-with-clear-instructions class=md-nav__link> <span class=md-ellipsis> 1. Start with Clear Instructions </span> </a> </li> <li class=md-nav__item> <a href=#2-review-changes-before-production class=md-nav__link> <span class=md-ellipsis> 2. Review Changes Before Production </span> </a> </li> <li class=md-nav__item> <a href=#3-use-workspace-directories class=md-nav__link> <span class=md-ellipsis> 3. Use Workspace Directories </span> </a> </li> <li class=md-nav__item> <a href=#4-implement-path-restrictions class=md-nav__link> <span class=md-ellipsis> 4. Implement Path Restrictions </span> </a> </li> <li class=md-nav__item> <a href=#5-iterative-development class=md-nav__link> <span class=md-ellipsis> 5. Iterative Development </span> </a> </li> <li class=md-nav__item> <a href=#6-handle-errors-gracefully class=md-nav__link> <span class=md-ellipsis> 6. Handle Errors Gracefully </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#common-issues class=md-nav__link> <span class=md-ellipsis> Common Issues </span> </a> </li> <li class=md-nav__item> <a href=#getting-help class=md-nav__link> <span class=md-ellipsis> Getting Help </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-configuration class=md-nav__link> <span class=md-ellipsis> Advanced Configuration </span> </a> <nav class=md-nav aria-label="Advanced Configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#custom-patch-editors class=md-nav__link> <span class=md-ellipsis> Custom Patch Editors </span> </a> </li> <li class=md-nav__item> <a href=#approval-workflows class=md-nav__link> <span class=md-ellipsis> Approval Workflows </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#getting-started class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=#additional-resources class=md-nav__link> <span class=md-ellipsis> Additional Resources </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ag2ai/ag2/edit/main/website/docs/_blogs/2025-12-22-GPT-5.1-Apply-Patch-Tool/index.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m7 14.94 6.06-6.06 2.06 2.06L9.06 17H7zM12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m4.7-10.65-1 1-2.05-2.05 1-1c.21-.22.56-.22.77 0l1.28 1.28c.22.21.22.56 0 .77M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2"></path></svg> </a> <h1>GPT-5.1 Apply Patch Tool: Automated Code Editing in AG2</h1> <p>AG2 now supports the <strong>apply_patch</strong> tool (from GPT-5.1 onward) through OpenAI's Responses API, enabling agents to create, update, and delete files using structured diffs. This integration brings precise, controlled file operations directly into your agent workflows.</p> <p>This article explores how to use apply_patch in AG2, with practical examples for automated code editing, project scaffolding, and multi-file refactoring.</p> <h2 id=what-is-apply-patch>What is Apply Patch?<a class=headerlink href=#what-is-apply-patch title="Permanent link">#</a></h2> <p>The <code>apply_patch</code> tool is a built-in capability in GPT-5.1 and above models that enables agents to perform structured file operations using unified diff format. Unlike traditional code generation approaches where agents output raw code blocks that you must manually integrate, apply_patch provides a standardized interface for file modifications that can be directly applied to your codebase.</p> <p>The tool handles three core operations: - <strong>create_file</strong>: Generate new files with specified content - <strong>update_file</strong>: Modify existing files using unified diff format - <strong>delete_file</strong>: Remove files from the workspace</p> <p><strong>Why Apply Patch Matters:</strong></p> <p>Traditional agent-based code generation often requires manual intervention—you receive code blocks, review them, and manually integrate changes. Apply patch transforms this workflow by enabling agents to: - Make precise, targeted changes using diff format - Handle multi-file operations in a single interaction - Provide structured, reviewable changes before application - Support iterative refinement through feedback loops</p> <p><strong>When to use Apply Patch:</strong></p> <p>Use apply_patch when you need: - <strong>Multi-file refactoring</strong>: Renaming symbols, extracting helpers, or reorganizing modules across multiple files - <strong>Project scaffolding</strong>: Generating complete project structures with multiple files and directories - <strong>Iterative code improvement</strong>: Making incremental changes based on feedback or test results - <strong>Automated code fixes</strong>: Applying structured fixes to codebases based on linter output or error messages - <strong>Documentation and test generation</strong>: Creating test files, fixtures, and documentation alongside code changes</p> <p>Don't use apply_patch for simple, single-file code generation where direct code output is sufficient—standard AG2 code generation patterns are more efficient for that.</p> <p>Note: AG2's apply_patch implementation integrates with OpenAI's Responses API. For protocol-level details, see <a href=https://platform.openai.com/docs/guides/tools-apply-patch>OpenAI's Apply Patch documentation</a>.</p> <h2 id=understanding-the-diff-format>Understanding the Diff Format<a class=headerlink href=#understanding-the-diff-format title="Permanent link">#</a></h2> <p>Before diving into implementation, it's crucial to understand how apply_patch represents changes. The tool uses unified diff format, which provides a clear, line-by-line representation of modifications.</p> <p>Here's a simple example:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gu>@@ -1,3 +1,3 @@</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w> </span>def hello():
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gd>-    print("World")</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=gi>+    print("Hello, World")</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w> </span>    return True
</code></pre></div> <p>This diff shows: - <code>@@ -1,3 +1,3 @@</code>: The hunk header indicating the change spans lines 1-3 in both old and new versions - Lines prefixed with <code>-</code>: Content to remove - Lines prefixed with <code>+</code>: Content to add - Lines without prefix: Context lines that remain unchanged</p> <p>GPT-5.1 automatically generates these diffs when using the apply_patch tool, ensuring changes are precise and reviewable before application.</p> <h2 id=basic-setup-and-configuration>Basic Setup and Configuration<a class=headerlink href=#basic-setup-and-configuration title="Permanent link">#</a></h2> <p>Getting started with apply_patch in AG2 is straightforward. You need GPT-5.1 or any model above 5.1 access and AG2 installed with OpenAI support.</p> <h3 id=installation>Installation<a class=headerlink href=#installation title="Permanent link">#</a></h3> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>pip<span class=w> </span>install<span class=w> </span>ag2<span class=o>[</span>openai<span class=o>]</span>
</code></pre></div> <h3 id=configuration>Configuration<a class=headerlink href=#configuration title="Permanent link">#</a></h3> <p>Configure your LLM to use the Responses API with GPT-5.1 or above models and enable the apply_patch tool:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=kn>from</span><span class=w> </span><span class=nn>dotenv</span><span class=w> </span><span class=kn>import</span> <span class=n>load_dotenv</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen</span><span class=w> </span><span class=kn>import</span> <span class=n>ConversableAgent</span><span class=p>,</span> <span class=n>LLMConfig</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=n>load_dotenv</span><span class=p>()</span>
<a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
<a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span>
<a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>    <span class=n>config_list</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>        <span class=s2>"api_type"</span><span class=p>:</span> <span class=s2>"responses"</span><span class=p>,</span>
<a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>        <span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-5.1"</span><span class=p>,</span>
<a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>        <span class=s2>"api_key"</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>"OPENAI_API_KEY"</span><span class=p>),</span>
<a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>        <span class=s2>"built_in_tools"</span><span class=p>:</span> <span class=p>[</span><span class=s2>"apply_patch"</span><span class=p>],</span>
<a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>    <span class=p>},</span>
<a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a><span class=p>)</span>
</code></pre></div> <p>The key configuration here is <code>"built_in_tools": ["apply_patch"]</code>, which enables the tool for your agent. When specified, AG2 automatically registers the apply_patch tool handler, so you don't need to manually create editors or patch tools.</p> <h3 id=creating-your-first-agent>Creating Your First Agent<a class=headerlink href=#creating-your-first-agent title="Permanent link">#</a></h3> <p>Create a coding assistant agent that can use apply_patch:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>coding_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"coding_assistant"</span><span class=p>,</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"""You are a helpful coding assistant. You can create, edit, and delete files</span>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=s2>    using the apply_patch tool. When making changes, always use the apply_patch tool rather than</span>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=s2>    writing raw code blocks. Be precise with your file operations and explain what you're doing."""</span><span class=p>,</span>
<a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=p>)</span>
</code></pre></div> <p>That's it, The agent is now ready to use apply_patch. The tool is automatically available when you specify it in <code>built_in_tools</code>.</p> <h2 id=creating-projects-with-apply-patch>Creating Projects with Apply Patch<a class=headerlink href=#creating-projects-with-apply-patch title="Permanent link">#</a></h2> <p>Let's explore practical examples, starting with project creation.</p> <h3 id=example-1-simple-project-scaffolding>Example 1: Simple Project Scaffolding<a class=headerlink href=#example-1-simple-project-scaffolding title="Permanent link">#</a></h3> <p>Create a new Python project structure:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>result</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"""</span>
<a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=s2>    Create a new Python project folder called 'calculator' with the following structure:</span>
<a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=s2>    1. Create a main.py file with a Calculator class that has methods for add, subtract, multiply, and divide</span>
<a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=s2>    """</span><span class=p>,</span>
<a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>    <span class=n>clear_history</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <p>The agent will use apply_patch to create the necessary files with the specified structure. This demonstrates how apply_patch enables multi-step file operations in a single interaction.</p> <h3 id=example-2-complete-application-structure>Example 2: Complete Application Structure<a class=headerlink href=#example-2-complete-application-structure title="Permanent link">#</a></h3> <p>Create a more complex application with multiple files:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>result</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"""</span>
<a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=s2>    Create a FastAPI application with the following structure:</span>
<a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=s2>    1. Create app/main.py with a FastAPI app and a simple /health endpoint</span>
<a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=s2>    2. Create app/__init__.py</span>
<a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=s2>    3. Create app/requirements.txt with fastapi and uvicorn</span>
<a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=s2>    4. Create a app/README.md with setup and run instructions</span>
<a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=s2>    5. Create app/.gitignore file for Python projects</span>
<a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=s2>    """</span><span class=p>,</span>
<a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    <span class=n>clear_history</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <p>This example shows apply_patch's strength in handling complex, multi-file project generation. The agent creates the entire application structure in one go, with proper file organization and dependencies.</p> <h2 id=workspace-directory-configuration>Workspace Directory Configuration<a class=headerlink href=#workspace-directory-configuration title="Permanent link">#</a></h2> <p>AG2's apply_patch integration supports dedicated workspace directories, providing better organization and isolation for your projects.</p> <h3 id=setting-up-a-workspace>Setting Up a Workspace<a class=headerlink href=#setting-up-a-workspace title="Permanent link">#</a></h3> <p>Specify a workspace directory directly in your LLM configuration:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>    <span class=n>config_list</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>        <span class=s2>"api_type"</span><span class=p>:</span> <span class=s2>"responses"</span><span class=p>,</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>        <span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-5.1"</span><span class=p>,</span>
<a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>        <span class=s2>"api_key"</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>"OPENAI_API_KEY"</span><span class=p>),</span>
<a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>        <span class=s2>"built_in_tools"</span><span class=p>:</span> <span class=p>[</span><span class=s2>"apply_patch"</span><span class=p>],</span>
<a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>        <span class=s2>"workspace_dir"</span><span class=p>:</span> <span class=s2>"./my_project_folder"</span><span class=p>,</span>  <span class=c1># Root project directory</span>
<a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>    <span class=p>},</span>
<a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=p>)</span>
<a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>
<a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=n>coding_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"coding_assistant"</span><span class=p>,</span>
<a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"""You are a helpful coding assistant..."""</span><span class=p>,</span>
<a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=p>)</span>
</code></pre></div> <p>When you specify <code>workspace_dir</code>, all file operations are relative to this directory. This provides: - <strong>Project isolation</strong>: Each workspace is self-contained - <strong>Path safety</strong>: Operations are scoped to the workspace - <strong>Easy cleanup</strong>: Delete the workspace directory to remove all generated files</p> <h3 id=using-workspace-directory>Using Workspace Directory<a class=headerlink href=#using-workspace-directory title="Permanent link">#</a></h3> <p>Once configured, use the agent to create files within the workspace:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>result</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"""</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=s2>    Create app.py in the workspace directory,</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=s2>    create a app.yaml file,</span>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=s2>    create a app.sh file,</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=s2>    create a folder /tests,</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=s2>    create tests/test_app.py</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=s2>    """</span><span class=p>,</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <p>All files are created relative to <code>./my_project_folder</code>, keeping your project organized and isolated.</p> <h2 id=security-with-allowed-paths>Security with Allowed Paths<a class=headerlink href=#security-with-allowed-paths title="Permanent link">#</a></h2> <p>For production use, you'll want to restrict file operations to specific directories. AG2's apply_patch supports <code>allowed_paths</code>, a security feature that limits where files can be created, updated, or deleted.</p> <h3 id=understanding-allowed-paths>Understanding Allowed Paths<a class=headerlink href=#understanding-allowed-paths title="Permanent link">#</a></h3> <p>The <code>allowed_paths</code> configuration accepts glob-style patterns with <code>**</code> for recursive matching. This works for both local filesystem and cloud storage paths.</p> <p><strong>Pattern Examples:</strong> - <code>["**"]</code> - Allow all paths (default, use with caution) - <code>["src/**"]</code> - Allow all files in <code>src/</code> and subdirectories - <code>["tests/**", "src/**"]</code> - Allow paths in multiple directories - <code>["*.py"]</code> - Allow Python files in root directory only</p> <h3 id=configuring-allowed-paths>Configuring Allowed Paths<a class=headerlink href=#configuring-allowed-paths title="Permanent link">#</a></h3> <p>Set up path restrictions in your LLM configuration:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>    <span class=n>config_list</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>        <span class=s2>"api_type"</span><span class=p>:</span> <span class=s2>"responses"</span><span class=p>,</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>        <span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-5.1"</span><span class=p>,</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>        <span class=s2>"api_key"</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>"OPENAI_API_KEY"</span><span class=p>),</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>        <span class=s2>"built_in_tools"</span><span class=p>:</span> <span class=p>[</span><span class=s2>"apply_patch"</span><span class=p>],</span>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>        <span class=s2>"workspace_dir"</span><span class=p>:</span> <span class=s2>"./my_project_folder"</span><span class=p>,</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>        <span class=s2>"allowed_paths"</span><span class=p>:</span> <span class=p>[</span><span class=s2>"src/**"</span><span class=p>,</span> <span class=s2>"tests/**"</span><span class=p>],</span>  <span class=c1># Only allow operations in these paths</span>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>    <span class=p>},</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=p>)</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=n>coding_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"coding_assistant"</span><span class=p>,</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"""You are a helpful coding assistant..."""</span><span class=p>,</span>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=p>)</span>
</code></pre></div> <h3 id=testing-path-restrictions>Testing Path Restrictions<a class=headerlink href=#testing-path-restrictions title="Permanent link">#</a></h3> <p>Verify that path restrictions work correctly:</p> <p><strong>Test 1: Allowed path (should succeed)</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=n>result1</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"Create src/main.py with a simple hello world function"</span><span class=p>,</span>
<a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <p>This succeeds because <code>src/main.py</code> matches the <code>src/**</code> pattern.</p> <p><strong>Test 2: Disallowed path (should fail)</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=n>result2</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"Create config/settings.json in the config directory (outside of src/ and tests/)"</span><span class=p>,</span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <p>This fails because <code>config/settings.json</code> doesn't match any allowed pattern. The agent will report that the path is not allowed.</p> <p><strong>Test 3: Root-level file (should fail)</strong></p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>result3</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"Create a file called root_file.py in the root of the workspace (not in src/ or tests/)"</span><span class=p>,</span>
<a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <p>This also fails because root-level files don't match the <code>src/**</code> or <code>tests/**</code> patterns.</p> <h3 id=security-best-practices>Security Best Practices<a class=headerlink href=#security-best-practices title="Permanent link">#</a></h3> <p>When using allowed_paths: 1. <strong>Start restrictive</strong>: Begin with specific directories and expand as needed 2. <strong>Use workspace_dir</strong>: Combine with workspace_dir for better isolation 3. <strong>Review patterns</strong>: Test your patterns to ensure they match intended paths 4. <strong>Document restrictions</strong>: Make path restrictions clear in your system messages</p> <h2 id=asynchronous-patch-operations>Asynchronous Patch Operations<a class=headerlink href=#asynchronous-patch-operations title="Permanent link">#</a></h2> <p>For better performance with multiple file operations, AG2 supports asynchronous patch application. This is particularly useful when creating or updating many files simultaneously.</p> <h3 id=enabling-async-patches>Enabling Async Patches<a class=headerlink href=#enabling-async-patches title="Permanent link">#</a></h3> <p>Use <code>apply_patch_async</code> instead of <code>apply_patch</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=n>llm_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span>
<a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>    <span class=n>config_list</span><span class=o>=</span><span class=p>{</span>
<a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>        <span class=s2>"api_type"</span><span class=p>:</span> <span class=s2>"responses"</span><span class=p>,</span>
<a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>        <span class=s2>"model"</span><span class=p>:</span> <span class=s2>"gpt-5.1"</span><span class=p>,</span>
<a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>        <span class=s2>"api_key"</span><span class=p>:</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>"OPENAI_API_KEY"</span><span class=p>),</span>
<a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>        <span class=s2>"built_in_tools"</span><span class=p>:</span> <span class=p>[</span><span class=s2>"apply_patch_async"</span><span class=p>],</span>  <span class=c1># Use async version</span>
<a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>        <span class=s2>"workspace_dir"</span><span class=p>:</span> <span class=s2>"./my_project_folder"</span><span class=p>,</span>
<a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>    <span class=p>},</span>
<a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=p>)</span>
<a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>
<a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=n>coding_agent</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"coding_assistant"</span><span class=p>,</span>
<a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"""You are a helpful coding assistant..."""</span><span class=p>,</span>
<a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=p>)</span>
</code></pre></div> <h3 id=using-async-patches>Using Async Patches<a class=headerlink href=#using-async-patches title="Permanent link">#</a></h3> <p>Async patches work the same way from the agent's perspective, but file operations are performed asynchronously:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=n>result</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>initiate_chat</span><span class=p>(</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>    <span class=n>recipient</span><span class=o>=</span><span class=n>coding_agent</span><span class=p>,</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"""</span>
<a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=s2>    use apply_patch tool to create a project test_project with the following structure:</span>
<a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=s2>    - create a project.py file</span>
<a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=s2>    - create a tests folder</span>
<a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=s2>    - create a tests/test_main.py file</span>
<a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=s2>    """</span><span class=p>,</span>
<a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
<a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=p>)</span>
</code></pre></div> <p>The async implementation uses <code>aiofiles</code> for non-blocking I/O, which can significantly improve performance when handling multiple files. Note that <code>aiofiles</code> must be installed separately:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>pip<span class=w> </span>install<span class=w> </span>aiofiles
</code></pre></div> <h3 id=when-to-use-async>When to Use Async<a class=headerlink href=#when-to-use-async title="Permanent link">#</a></h3> <p>Use async patches when: - Creating or updating many files in a single operation - Working with large files that might block I/O - Building applications that need to remain responsive during file operations - Processing batch operations on multiple files</p> <p>For simple, single-file operations, the synchronous <code>apply_patch</code> is sufficient and simpler.</p> <h2 id=implementation-patterns>Implementation Patterns<a class=headerlink href=#implementation-patterns title="Permanent link">#</a></h2> <h3 id=pattern-1-iterative-code-improvement>Pattern 1: Iterative Code Improvement<a class=headerlink href=#pattern-1-iterative-code-improvement title="Permanent link">#</a></h3> <p>Apply patch excels at iterative refinement. Start with initial code, then refine based on feedback:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=c1># Initial creation</span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=n>result1</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"Create a simple calculator class with basic operations"</span><span class=p>,</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=c1># Refinement based on requirements</span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=n>result2</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"Add error handling and input validation to the calculator"</span><span class=p>,</span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=c1># Further refinement</span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=n>result3</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"Add logging and type hints to all methods"</span><span class=p>,</span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <p>Each iteration builds on the previous state, with apply_patch making precise, targeted changes.</p> <h3 id=pattern-2-multi-agent-collaboration>Pattern 2: Multi-Agent Collaboration<a class=headerlink href=#pattern-2-multi-agent-collaboration title="Permanent link">#</a></h3> <p>Combine apply_patch with multiple agents for complex workflows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1># Code generator agent</span>
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=n>coder</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"Coder"</span><span class=p>,</span>
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"Generate code using apply_patch"</span><span class=p>,</span>
<a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=p>)</span>
<a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>
<a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=c1># Reviewer agent</span>
<a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=n>reviewer</span> <span class=o>=</span> <span class=n>ConversableAgent</span><span class=p>(</span>
<a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"Reviewer"</span><span class=p>,</span>
<a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>    <span class=n>llm_config</span><span class=o>=</span><span class=n>llm_config</span><span class=p>,</span>
<a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>    <span class=n>system_message</span><span class=o>=</span><span class=s2>"Review code and suggest improvements"</span><span class=p>,</span>
<a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=p>)</span>
<a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a>
<a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=c1># Generate code</span>
<a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=n>result</span> <span class=o>=</span> <span class=n>coder</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"Create a REST API with CRUD operations"</span><span class=p>,</span>
<a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
<a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a>
<a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=c1># Review and improve</span>
<a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a><span class=n>improved</span> <span class=o>=</span> <span class=n>reviewer</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a>    <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>"Review the generated code and suggest improvements: </span><span class=si>{</span><span class=n>result</span><span class=o>.</span><span class=n>summary</span><span class=si>}</span><span class=s2>"</span><span class=p>,</span>
<a id=__codelineno-16-24 name=__codelineno-16-24 href=#__codelineno-16-24></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-16-25 name=__codelineno-16-25 href=#__codelineno-16-25></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <p>The reviewer can use apply_patch to directly implement suggested improvements.</p> <h3 id=pattern-3-test-driven-development>Pattern 3: Test-Driven Development<a class=headerlink href=#pattern-3-test-driven-development title="Permanent link">#</a></h3> <p>Generate tests first, then implement code:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1># Create test file</span>
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=n>result1</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"Create tests/test_calculator.py with comprehensive test cases for a Calculator class"</span><span class=p>,</span>
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
<a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a>
<a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=c1># Implement the class to pass tests</span>
<a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=n>result2</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a>    <span class=n>message</span><span class=o>=</span><span class=s2>"Create src/calculator.py with a Calculator class that passes all tests in tests/test_calculator.py"</span><span class=p>,</span>
<a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>    <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <p>Apply patch makes it easy to maintain consistency between tests and implementation.</p> <h2 id=best-practices>Best Practices<a class=headerlink href=#best-practices title="Permanent link">#</a></h2> <h3 id=1-start-with-clear-instructions>1. Start with Clear Instructions<a class=headerlink href=#1-start-with-clear-instructions title="Permanent link">#</a></h3> <p>Provide detailed requirements for what you want to create or modify:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># Good: Specific and detailed</span>
<a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=n>message</span> <span class=o>=</span> <span class=s2>"""</span>
<a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=s2>Create a FastAPI application with:</span>
<a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=s2>1. A /health endpoint that returns {'status': 'ok'}</span>
<a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=s2>2. A /users endpoint with GET and POST methods</span>
<a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=s2>3. Proper error handling and status codes</span>
<a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=s2>4. A requirements.txt with fastapi and uvicorn</span>
<a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=s2>"""</span>
<a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>
<a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=c1># Less ideal: Vague</span>
<a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=n>message</span> <span class=o>=</span> <span class=s2>"Create a web app"</span>
</code></pre></div> <h3 id=2-review-changes-before-production>2. Review Changes Before Production<a class=headerlink href=#2-review-changes-before-production title="Permanent link">#</a></h3> <p>Always review files created or modified by the agent before using them in production. Apply patch provides structured diffs that are easy to review, but human oversight is still important.</p> <h3 id=3-use-workspace-directories>3. Use Workspace Directories<a class=headerlink href=#3-use-workspace-directories title="Permanent link">#</a></h3> <p>Isolate projects using workspace directories:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1># Each project gets its own workspace</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=n>project_a_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>workspace_dir</span><span class=o>=</span><span class=s2>"./project_a"</span><span class=p>)</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=n>project_b_config</span> <span class=o>=</span> <span class=n>LLMConfig</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>workspace_dir</span><span class=o>=</span><span class=s2>"./project_b"</span><span class=p>)</span>
</code></pre></div> <p>This prevents accidental cross-project modifications and makes cleanup easier.</p> <h3 id=4-implement-path-restrictions>4. Implement Path Restrictions<a class=headerlink href=#4-implement-path-restrictions title="Permanent link">#</a></h3> <p>Use allowed_paths in production to prevent unauthorized file operations:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1># Restrict to specific directories</span>
<a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=n>allowed_paths</span> <span class=o>=</span> <span class=p>[</span><span class=s2>"src/**"</span><span class=p>,</span> <span class=s2>"tests/**"</span><span class=p>,</span> <span class=s2>"docs/**"</span><span class=p>]</span>
</code></pre></div> <h3 id=5-iterative-development>5. Iterative Development<a class=headerlink href=#5-iterative-development title="Permanent link">#</a></h3> <p>Break complex tasks into smaller steps:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1># Step 1: Create basic structure</span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=n>result1</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>message</span><span class=o>=</span><span class=s2>"Create project structure"</span><span class=p>,</span> <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=c1># Step 2: Add core functionality</span>
<a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=n>result2</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>message</span><span class=o>=</span><span class=s2>"Implement core features"</span><span class=p>,</span> <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
<a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>
<a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=c1># Step 3: Add tests</span>
<a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=n>result3</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>message</span><span class=o>=</span><span class=s2>"Add comprehensive tests"</span><span class=p>,</span> <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</code></pre></div> <p>Verify each step before proceeding to the next.</p> <h3 id=6-handle-errors-gracefully>6. Handle Errors Gracefully<a class=headerlink href=#6-handle-errors-gracefully title="Permanent link">#</a></h3> <p>The agent can fix bugs, but review error messages carefully:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=k>try</span><span class=p>:</span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>message</span><span class=o>=</span><span class=s2>"..."</span><span class=p>,</span> <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
<a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>    <span class=c1># Review the error and provide feedback</span>
<a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>coding_agent</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
<a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>        <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>"Fix the error: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>"</span><span class=p>,</span>
<a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a>        <span class=n>max_turns</span><span class=o>=</span><span class=mi>2</span>
<a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>    <span class=p>)</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">#</a></h2> <h3 id=common-issues>Common Issues<a class=headerlink href=#common-issues title="Permanent link">#</a></h3> <p><strong>1. File Not Found Errors</strong></p> <p>Ensure file paths are correct relative to the workspace directory:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># If workspace_dir is "./my_project"</span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=c1># Use: "src/main.py" not "/src/main.py" or "./src/main.py"</span>
</code></pre></div> <p><strong>2. Permission Errors</strong></p> <p>Ensure the agent has write permissions to the workspace directory:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=n>os</span><span class=o>.</span><span class=n>chmod</span><span class=p>(</span><span class=s2>"./my_project_folder"</span><span class=p>,</span> <span class=mo>0o755</span><span class=p>)</span>  <span class=c1># Ensure write permissions</span>
</code></pre></div> <p><strong>3. Path Restriction Errors</strong></p> <p>If operations fail with path restriction errors, check your <code>allowed_paths</code> patterns:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># Test your patterns</span>
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=kn>from</span><span class=w> </span><span class=nn>pathlib</span><span class=w> </span><span class=kn>import</span> <span class=n>PurePath</span>
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=n>pattern</span> <span class=o>=</span> <span class=s2>"src/**"</span>
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=n>test_path</span> <span class=o>=</span> <span class=s2>"src/main.py"</span>
<a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=nb>print</span><span class=p>(</span><span class=n>PurePath</span><span class=p>(</span><span class=n>test_path</span><span class=p>)</span><span class=o>.</span><span class=n>match</span><span class=p>(</span><span class=n>pattern</span><span class=p>))</span>  <span class=c1># Should be True</span>
</code></pre></div> <p><strong>4. API Errors</strong></p> <p>Verify your OpenAI API key has access to GPT-5.1:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=kn>import</span><span class=w> </span><span class=nn>openai</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=n>client</span> <span class=o>=</span> <span class=n>openai</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>api_key</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>"OPENAI_API_KEY"</span><span class=p>))</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=c1># Test API access</span>
</code></pre></div> <p><strong>5. Async Import Errors</strong></p> <p>If using async patches, ensure <code>aiofiles</code> is installed:</p> <p>pip install aiofiles</p> <h3 id=getting-help>Getting Help<a class=headerlink href=#getting-help title="Permanent link">#</a></h3> <p>For more information: - <a href=https://docs.ag2.ai>AG2 Documentation</a> - <a href=https://platform.openai.com/docs/api-reference/responses>OpenAI Responses API Documentation</a> - <a href=https://platform.openai.com/docs/guides/tools-apply-patch>OpenAI Apply Patch Guide</a> - <a href=https://github.com/AG2ai/ag2/issues>GitHub Issues</a></p> <h2 id=advanced-configuration>Advanced Configuration<a class=headerlink href=#advanced-configuration title="Permanent link">#</a></h2> <h3 id=custom-patch-editors>Custom Patch Editors<a class=headerlink href=#custom-patch-editors title="Permanent link">#</a></h3> <p>For advanced use cases, you can implement custom <code>PatchEditor</code> protocols:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.tools.experimental.apply_patch</span><span class=w> </span><span class=kn>import</span> <span class=n>PatchEditor</span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=k>class</span><span class=w> </span><span class=nc>CloudStorageEditor</span><span class=p>(</span><span class=n>PatchEditor</span><span class=p>):</span>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=w>    </span><span class=sd>"""Custom editor for cloud storage backends."""</span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>    <span class=k>def</span><span class=w> </span><span class=nf>create_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>operation</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>        <span class=c1># Implement cloud storage file creation</span>
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>        <span class=o>...</span>
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>
<a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>a_create_file</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>operation</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
<a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a>        <span class=c1># Implement async cloud storage file creation</span>
<a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a>        <span class=o>...</span>
<a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a>
<a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>    <span class=c1># Implement other required methods...</span>
</code></pre></div> <p>This enables integration with cloud storage, databases, or other custom backends.</p> <h3 id=approval-workflows>Approval Workflows<a class=headerlink href=#approval-workflows title="Permanent link">#</a></h3> <p>Implement approval workflows for sensitive operations:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=kn>from</span><span class=w> </span><span class=nn>autogen.tools.experimental.apply_patch</span><span class=w> </span><span class=kn>import</span> <span class=n>ApplyPatchTool</span><span class=p>,</span> <span class=n>WorkspaceEditor</span>
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=k>def</span><span class=w> </span><span class=nf>approval_callback</span><span class=p>(</span><span class=n>ctx</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>item</span><span class=p>:</span> <span class=nb>dict</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>    </span><span class=sd>"""Custom approval logic."""</span>
<a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>    <span class=n>path</span> <span class=o>=</span> <span class=n>item</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>"path"</span><span class=p>,</span> <span class=s2>""</span><span class=p>)</span>
<a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>    <span class=k>if</span> <span class=s2>"config"</span> <span class=ow>in</span> <span class=n>path</span> <span class=ow>or</span> <span class=s2>"secrets"</span> <span class=ow>in</span> <span class=n>path</span><span class=p>:</span>
<a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>        <span class=k>return</span> <span class=p>{</span><span class=s2>"approve"</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>"reason"</span><span class=p>:</span> <span class=s2>"Config files require manual review"</span><span class=p>}</span>
<a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>    <span class=k>return</span> <span class=p>{</span><span class=s2>"approve"</span><span class=p>:</span> <span class=kc>True</span><span class=p>}</span>
<a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>
<a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=n>editor</span> <span class=o>=</span> <span class=n>WorkspaceEditor</span><span class=p>(</span><span class=n>workspace_dir</span><span class=o>=</span><span class=s2>"./project"</span><span class=p>)</span>
<a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=n>patch_tool</span> <span class=o>=</span> <span class=n>ApplyPatchTool</span><span class=p>(</span>
<a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a>    <span class=n>editor</span><span class=o>=</span><span class=n>editor</span><span class=p>,</span>
<a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a>    <span class=n>needs_approval</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a>    <span class=n>on_approval</span><span class=o>=</span><span class=n>approval_callback</span><span class=p>,</span>
<a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=p>)</span>
</code></pre></div> <h2 id=getting-started>Getting Started<a class=headerlink href=#getting-started title="Permanent link">#</a></h2> <ol> <li> <p><strong>Install AG2 with OpenAI support</strong>: </p><div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>pip<span class=w> </span>install<span class=w> </span>ag2<span class=o>[</span>openai<span class=o>]</span>
</code></pre></div><p></p> </li> <li> <p><strong>Get GPT-5.1 access</strong>: Ensure your OpenAI API key has access to GPT-5.1</p> </li> <li> <p><strong>Try the examples</strong>: Start with simple file creation, then move to more complex multi-file operations</p> </li> <li> <p><strong>Review the documentation</strong>: <a href=https://platform.openai.com/docs/guides/tools-apply-patch>OpenAI Apply Patch Guide</a></p> </li> <li> <p><strong>Experiment</strong>: Build your own workflows combining apply_patch with other AG2 features</p> </li> </ol> <h2 id=additional-resources>Additional Resources<a class=headerlink href=#additional-resources title="Permanent link">#</a></h2> <ul> <li><a href=https://docs.ag2.ai/latest/docs/user-guide/tools/ >AG2 Tools Documentation</a></li> <li><a href=https://platform.openai.com/docs/api-reference/responses>OpenAI Responses API</a></li> <li><a href=https://platform.openai.com/docs/guides/tools-apply-patch>OpenAI Apply Patch Tool</a></li> <li><a href=https://github.com/AG2ai/ag2/tree/main/notebook/agentchat_gpt5.1_apply_patch_example.ipynb>Example Notebook</a></li> </ul> <hr> <p>The apply_patch tool represents a significant step forward in agent-based code generation, providing structured, reviewable, and precise file operations. By integrating this capability into AG2, we enable more sophisticated and reliable automated code editing workflows. Start experimenting with apply_patch today and discover new possibilities for agent-driven development.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="January 5, 2026 21:58:54 UTC"><span class=timeago datetime=2026-01-05T21:58:54+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="January 5, 2026 21:58:54 UTC">2026-01-05</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> © 2025 <a href=https://ag2.ai/ target=_blank rel=noopener>ag2</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://discord.gg/pAbnFJrkgZ target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"></path></svg> </a> <a href=https://github.com/ag2ai/ag2 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"></path></svg> </a> <a href=https://x.com/ag2oss target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"></path></svg> </a> <a href=https://www.youtube.com/@ag2ai target=_blank rel=noopener title=www.youtube.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z"></path></svg> </a> <a href=https://www.linkedin.com/company/ag2ai target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["search.suggest", "search.highlight", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.tracking", "navigation.prune", "navigation.top", "navigation.footer", "content.tabs.link", "content.code.copy", "content.code.annotate", "content.action.edit"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.92b07e13.min.js></script> <script src=../../../js/timeago.min.js></script> <script src=../../../js/timeago_mkdocs_material.js></script> <script src=../../../javascripts/extra.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>